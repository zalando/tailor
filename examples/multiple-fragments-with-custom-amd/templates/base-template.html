<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" rel="icon" type="image/x-icon" />
    <script type="slot" name="head"></script>
    <script>
        require.config({onNodeCreated: function(node){node.crossOrigin="anonymous"}});
        // Example dependencies for the fragments
        define('js1', function () {
            return 'js1';
        });
        define('js2', function () {
            return 'js2';
        });

        // Testing hook calls via logs
        var log = {
            'range-0-1' : [],
            'range-2-3' : [],
            'range-4-5' : [],
            'common': [],
        };
        var ranges = [[0,1],[2,3],[4,5]];
        var result = '';

        function rangeKey(range) {
            return('range-' + range.join('-'));
        }

        Pipe.onStart((attributes) => {
          log[rangeKey(attributes.range)].push('onStart');
        });
        Pipe.onBeforeInit((attributes) => {
          log[rangeKey(attributes.range)].push('onBeforeInit');
        });
        Pipe.onAfterInit((attributes) => {
          log[rangeKey(attributes.range)].push('onAfterInit');
        });

        Pipe.onDone(() => {
          log.common.push('onDone');

          var logNode = document.getElementById('hook-logs');
            ranges.forEach(function(range, index) {
              var key = rangeKey(range);
                result += key + ' hooks: ' + log[key].join(',') +';\n';
            });
            result += '   common hooks: ' + log.common.join(',') + ';';
            logNode.innerText = result;
            logNode.className += ' all-done';
        });
    </script>
</head>
<body>
    <slot name="body-start"></slot>
    <div>
        <script>
            // this tests that the pipe functionality may
            // not be broken by script after the placeholder scripts
            document.body.appendChild(document.createElement('script'));
        </script>
        <h2>Fragment 1:</h2>
        <fragment src="http://localhost:8081" primary></fragment>
        <h2>Fragment 2:</h2>
        <fragment async src="http://localhost:8082"></fragment>
        <div>All done!</div>
    </div>
    <pre id="hook-logs" class="logs"></pre>
</body>
</html>
